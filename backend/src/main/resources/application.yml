server:
  port: 8080

spring:
  application:
    name: beatlens

  # ═══ PostgreSQL Database ═══
  datasource:
    url: ${DATABASE_URL:jdbc:postgresql://localhost:5432/beatlens}
    driver-class-name: org.postgresql.Driver
    username: ${DATABASE_USERNAME:postgres}
    password: ${DATABASE_PASSWORD:postgres}

  jpa:
    hibernate:
      ddl-auto: validate  # Flyway manages schema; Hibernate only validates
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect

  flyway:
    enabled: true
    locations: classpath:db/migration

  servlet:
    multipart:
      max-file-size: 50MB
      max-request-size: 50MB

  # ═══ Caffeine Cache ═══
  cache:
    type: caffeine
    cache-names:
      - fingerprint-lookup    # hash -> List<FingerprintEntry>
      - song-metadata         # songId -> Song entity
    caffeine:
      spec: maximumSize=500000,expireAfterAccess=30m,recordStats

# ═══ Audio Fingerprinting Constants ═══
# These mirror AudioConstants.java defaults and can be overridden here.
beatlens:
  # ═══ CORS (defaults for local dev; override in docker profile or via env) ═══
  cors:
    allowed-origins: http://localhost:3000,http://localhost:5173
  audio:
    sample-rate: 44100
    bits-per-sample: 16
    channels: 1
  spectrogram:
    frame-size: 4096
    hop-size: 2048
  peak-detection:
    frequency-bands: [0, 300, 600, 1200, 2400, 5000, 10000, 22050]
    peaks-per-frame: 8
    neighborhood-size: 15
    min-amplitude: 0.01
  fingerprint:
    target-zone-size: 5
    fan-out: 20
    max-time-delta: 200
  matching:
    offset-tolerance: 3
    min-aligned-matches: 3
    min-confidence: 5.0

# ═══ Actuator (includes cache metrics) ═══
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,caches
